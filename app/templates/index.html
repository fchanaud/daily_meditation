{% extends "base.html" %}

{% block content %}
<div class="mood-container">
    <h2 class="mb-4">How are you feeling today?</h2>
    <p class="mb-4">Select your mood to find a 10-minute meditation that matches how you feel:</p>
    
    <form id="mood-form" action="/generate-meditation" method="post">
        <div class="mood-grid">
            {% for mood in moods %}
            <div class="mood-card" data-mood="{{ mood }}">
                <div class="mood-icon">
                    {% if mood == "calm" %}
                    <i class="fas fa-water"></i>
                    {% elif mood == "focused" %}
                    <i class="fas fa-bullseye"></i>
                    {% elif mood == "relaxed" %}
                    <i class="fas fa-couch"></i>
                    {% elif mood == "energized" %}
                    <i class="fas fa-bolt"></i>
                    {% elif mood == "grateful" %}
                    <i class="fas fa-heart"></i>
                    {% elif mood == "happy" %}
                    <i class="fas fa-smile-beam"></i>
                    {% elif mood == "peaceful" %}
                    <i class="fas fa-dove"></i>
                    {% elif mood == "confident" %}
                    <i class="fas fa-crown"></i>
                    {% elif mood == "creative" %}
                    <i class="fas fa-palette"></i>
                    {% elif mood == "compassionate" %}
                    <i class="fas fa-hands-helping"></i>
                    {% else %}
                    <i class="fas fa-spa"></i>
                    {% endif %}
                </div>
                <h5>{{ mood|title }}</h5>
                <div class="form-check" style="display: none;">
                    <input class="form-check-input mood-radio" type="radio" name="mood" id="mood-{{ mood }}" value="{{ mood }}">
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="language-selection mt-5 mb-4">
            <h5>Choose your language:</h5>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="language" id="language-english" value="english" checked>
                <label class="form-check-label" for="language-english">English</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="language" id="language-french" value="french">
                <label class="form-check-label" for="language-french">French</label>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg" id="find-meditation" disabled>
                Find My Meditation
            </button>
        </div>
    </form>
    
    <!-- Response container -->
    <div id="response-container" class="mt-4 text-center" style="display: none;">
        <div class="alert alert-info">
            <h4 id="response-title" class="alert-heading">Your meditation selection:</h4>
            <p id="response-message"></p>
            <hr>
            <p class="mb-0" id="response-note"></p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all mood cards
        const moodCards = document.querySelectorAll('.mood-card');
        const moodRadios = document.querySelectorAll('.mood-radio');
        const submitButton = document.getElementById('find-meditation');
        const responseContainer = document.getElementById('response-container');
        const responseMessage = document.getElementById('response-message');
        const responseNote = document.getElementById('response-note');
        
        // Add click event to mood cards
        moodCards.forEach(card => {
            card.addEventListener('click', function() {
                // Remove selected class from all cards
                moodCards.forEach(c => c.classList.remove('selected'));
                
                // Add selected class to clicked card
                this.classList.add('selected');
                
                // Check the radio button
                const moodValue = this.dataset.mood;
                const radio = document.getElementById('mood-' + moodValue);
                radio.checked = true;
                
                // Enable the submit button
                submitButton.disabled = false;
            });
        });
        
        // Form submission handler
        document.getElementById('mood-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get selected mood and language
            const selectedMood = document.querySelector('input[name="mood"]:checked').value;
            const selectedLanguage = document.querySelector('input[name="language"]:checked').value;
            
            // Show loading state
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';
            
            // Hide any previous response
            responseContainer.style.display = 'none';
            
            // Create fetch request
            fetch('/generate-meditation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    mood: selectedMood,
                    language: selectedLanguage
                })
            })
            .then(response => {
                if (response.ok) {
                    // Parse as JSON (different from original which used blob)
                    return response.json();
                }
                throw new Error('Network response was not ok');
            })
            .then(data => {
                // Display the response message
                responseMessage.textContent = data.message || 'Meditation selection successful';
                if (data.note) {
                    responseNote.textContent = data.note;
                }
                
                // Show the response container
                responseContainer.style.display = 'block';
                
                // Reset the button
                submitButton.disabled = false;
                submitButton.innerHTML = 'Find My Meditation';
                
                // Scroll to the response
                responseContainer.scrollIntoView({ behavior: 'smooth' });
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to generate meditation. Please try again.');
                
                // Reset the button
                submitButton.disabled = false;
                submitButton.innerHTML = 'Find My Meditation';
            });
        });
    });
</script>
{% endblock %} 